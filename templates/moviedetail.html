{% extends 'base.html' %}
{% load static custom_tags %}
{% block title %}
{{ movie.name }}
{% endblock %}

{% block style %}
<link rel="stylesheet" href="{% static 'css/moviedetail.css' %}">
{% endblock %}

{% block content %}
<div id="moviedetail" class="container">   
    <nav aria-label="breadcrumb" class="m-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
            <li class="breadcrumb-item"><a href="{% url 'movielist' %}">Movie List</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ movie.name }}</li>
        </ol>
    </nav> 
    <div id="info" class="m-3 p-3 border rounded">    
        <div class="row">
            <div class="col-md-3">
                <img class="movie-img rounded" src="{{ movie.image }}" alt="Movie image cap" style="border: 2px solid #263238; width: 100%; height: auto;">
            </div>
            <div class="col-md-9">
                <h4>{{ movie.name }}</h4>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <table class="table table-striped" style="font-size: 13px;">                
                            <tr>
                                <th>Genres</th>
                                <td>
                                    {% for genre in movie.genre.all %}
                                    {{ genre.name }}  
                                    {% endfor %}
                                </td>
                            </tr>
                            <tr>
                                <th>Release</th>
                                <td>{{ movie.release_date }}</td>
                            </tr>
                            <tr>
                                <th>Running time</th>
                                <td>{{ movie.runningtime }}</td>
                            </tr>
                            <tr>
                                <th>IMDB Rating</th>
                                <td>{{ movie.rating }}</td>
                            </tr>                                                       
                        </table> 
                    </div>
                    <div class="col-md-6">
                        <table class="table table-striped" style="font-size: 13px;">      
                            <tr>
                                <th>Production</th>
                                <td>
                                    
                                </td>
                            </tr>          
                            <tr>
                                <th>Director</th>
                                <td>
                                    {% for director in movie.director.all %}
                                    <a href="{% url 'artistdetail' director.pk %}">
                                        {{ director.name }}  
                                    </a>
                                    {% endfor %}
                                </td>
                            </tr>
                            <tr>
                                <th>Writer</th>
                                <td>
                                    
                                </td>
                            </tr>
                            <tr>
                                <th>Cast crew</th>
                                <td>
                                    {% for actor in movie.cast.all %}
                                    <a href="{% url 'artistdetail' actor.pk %}">
                                        {{ actor.name }}  
                                    </a>
                                    {% endfor %}
                                </td>
                            </tr>                          
                        </table> 
                    </div>
                </div>                       
            </div>
        </div>
    </div>
    <div id="about" class="m-3 p-3 border rounded">     
        <div class="row">
            <div class="col-md-4">
                <h5>Plot:</h5>        
                <p>{{ movie.plot }}</p>
            </div>
            <div class="col-md-8">
                <h5>Trailer:</h5>        
                <iframe width="100%" height="240" src="https://www.youtube.com/embed/LoebZZ8K5N0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>       
    </div>
    <div id="action" class="m-3 border rounded d-flex justify-content-around text-center">             
        <div id="like" class="w-100" data-toggle="tooltip" data-placement="top" title="{% if movie|is_liked:profile %}Remove from favorite list{% else %}Add to favorite list{% endif %}" data-id="{{ movie.id }}">
            <i id="icon-like" class="{% if movie|is_liked:profile %}fa fa-thumbs-up{% else %}fa fa-thumbs-o-up{% endif %}"></i>
            <p class="m-0">968</p>
        </div>
        <div id="watched" class="w-100" data-toggle="tooltip" data-placement="top" title="{% if movie|is_watched:profile %}Remove from watched list{% else %}Add to watched list{% endif %}" data-id="{{ movie.id }}">
            <i id="icon-watched" class="{% if movie|is_watched:profile %}fa fa-check-circle{% else %}fa fa-check-circle-o{% endif %}"></i>
            <p class="m-0">2374</p>
        </div>
        <div id="watchlist" class="w-100" data-toggle="tooltip" data-placement="top" title="{% if movie|is_added:profile %}Remove from watchlist{% else %}Add to watchlist{% endif %}" data-id="{{ movie.id }}">
            <i id="icon-watchlist" class="{% if movie|is_added:profile %}fa fa-plus-square{% else %}fa fa-plus-square-o{% endif %}"></i>
            <p class="m-0">2549</p>
        </div>
        <div class="w-100">
            <i class="fa fa-star-o"></i>
            <p class="m-0">{{ movie.rating }}</p>
        </div>
    </div>
    <div id="comments" class="m-3 p-3 border rounded">
        <div class="row">
            <div class="col-12 col-md-3 pl-3">                
                <p>127 comments</p>                
            </div>
            <div class="col-12 col-md-6">
                <div class="dropdown">
                    <button type="button" class="dropdown-toggle border-0 bg-transparent" data-toggle="dropdown">
                        Sort By
                    </button>
                    <div class="dropdown-menu">
                        <a href="#" class="dropdown-item">Top comments</a>
                        <a href="#" class="dropdown-item">Newest first</a>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-3 text-right">
                <p>{{ movie.views }} views</p>
            </div>
        </div>
        <hr class="m-0">
        <!-- <div class="media p-3">
            <img src="https://www.w3schools.com/bootstrap4/img_avatar5.png" alt="Jessie Doe" class="mr-3 mt-3 rounded-circle" style="width:60px;">
            <div class="media-body">
                <form action="." class="was-invalidated">
                    <div class="form-group">
                        <input type="text" class="form-control" id="name" placeholder="Name" name="name" required>
                        <input type="text" class="form-control" id="usercomment" placeholder="Leave comment" name="usercomment" required>
                    </div>
                </form>               
            </div>
        </div> -->
        <div class="media p-3">
            <img src="https://www.w3schools.com/bootstrap4/img_avatar3.png" alt="John Doe" class="mr-3 mt-3 rounded-circle" style="width:60px;">
            <div class="media-body">
                <p>John Doe <small><i>Posted on February 19, 2020</i></small></p>
                <small>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</small>                
                <div class="media p-3">
                    <img src="https://www.w3schools.com/bootstrap4/img_avatar4.png" alt="Jane Doe" class="mr-3 mt-3 rounded-circle" style="width:45px;">
                    <div class="media-body">
                        <p>Jane Doe <small><i>Posted on February 20 2020</i></small></p>
                        <small>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</small>                        
                    </div>
                </div>  
            </div>
        </div>
        <div class="media p-3">
            <img src="https://www.w3schools.com/bootstrap4/img_avatar2.png" alt="Jason Doe" class="mr-3 mt-3 rounded-circle" style="width:60px;">
            <div class="media-body">
                <p>Jason Doe <small><i>Posted on February 18, 2020</i></small></p>
                <small>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</small>                
            </div>
        </div>
        <div class="media p-3">
            <img src="https://www.w3schools.com/bootstrap4/img_avatar1.png" alt="Jack Doe" class="mr-3 mt-3 rounded-circle" style="width:60px;">
            <div class="media-body">
                <p>Jack Doe <small><i>Posted on February 17, 2020</i></small></p>
                <small>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</small>                
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascript %}
<script>
    $(document).ready(function(){
      $('[data-toggle="tooltip"]').tooltip();   
    });

    $('#like').click(function () {                
        var id = $(this).attr("data-id");       
        $.ajax({
            type: "GET",
            url: "/likemovie/",
            data: {
                movie_id: id
            },
            success: function(data)
            {
                if (data.is_liked) {
                    $("#like").attr('title', 'Remove from favorite list');                    
                    $("#icon-like").attr("class", "fa fa-thumbs-up");
                }
                else
                {
                    $("#like").attr('title', 'Add to favorite list');                          
                    $("#icon-like").attr("class", "fa fa-thumbs-o-up");
                }
            }
        })
    });

    $('#watched').click(function () {                
        var id = $(this).attr("data-id");       
        $.ajax({
            type: "GET",
            url: "/addtowatched/",
            data: {
                movie_id: id
            },
            success: function(data)
            {
                if (data.is_watched) {
                    $("#watched").attr('title', 'Remove from watched list');                    
                    $("#icon-watched").attr("class", "fa fa-check-circle");
                }
                else
                {
                    $("#watched").attr('title', 'Add to watched list');                          
                    $("#icon-watched").attr("class", "fa fa-check-circle-o");
                }
            }
        })
    });

    $('#watchlist').click(function () {                
        var id = $(this).attr("data-id");       
        $.ajax({
            type: "GET",
            url: "/addtowatchlist/",
            data: {
                movie_id: id
            },
            success: function(data)
            {
                if (data.is_added) {
                    $("#watchlist").attr('title', 'Remove from watchlist');                    
                    $("#icon-watchlist").attr("class", "fa fa-plus-square");
                }
                else
                {
                    $("#watchlist").attr('title', 'Add to watchlist');                          
                    $("#icon-watchlist").attr("class", "fa fa-plus-square-o");
                }
            }
        })
    });
</script>
{% endblock %}